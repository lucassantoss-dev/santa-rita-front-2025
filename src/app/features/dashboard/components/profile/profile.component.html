<div class="profile-container">
  <!-- Header da Página -->
  <div class="page-header">
    <div class="header-content">
      <div class="title-section">
        <h1 class="page-title">
          <mat-icon>person</mat-icon>
          Meu Perfil
        </h1>
        <p class="page-subtitle">Gerencie suas informações pessoais e configurações de conta</p>
      </div>
      <div class="header-actions">
        <button mat-raised-button
                color="primary"
                class="primary-action-btn"
                (click)="toggleEditMode()"
                [disabled]="isLoading">
          <mat-icon>{{ isEditMode ? 'close' : 'edit' }}</mat-icon>
          {{ isEditMode ? 'Cancelar' : 'Editar Perfil' }}
        </button>
      </div>
    </div>
  </div>

  <div class="profile-grid">
    <!-- Card de Informações do Usuário -->
    <mat-card class="profile-card user-info-card">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>account_circle</mat-icon>
          Informações Pessoais
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <!-- Avatar Section -->
        <div class="avatar-section">
          <div class="avatar-container">
            <img *ngIf="user.avatar" [src]="user.avatar" [alt]="user.name" class="user-avatar">
            <div *ngIf="!user.avatar" class="avatar-placeholder">
              {{ getInitials(user.name) }}
            </div>

            <button mat-mini-fab
                    class="avatar-edit-btn"
                    color="primary"
                    (click)="avatarInput.click()"
                    [disabled]="isLoading">
              <mat-icon>camera_alt</mat-icon>
            </button>

            <input #avatarInput
                   type="file"
                   accept="image/*"
                   style="display: none"
                   (change)="onUploadAvatar($event)">
          </div>

          <div class="user-basic-info">
            <h3>{{ user.name }}</h3>
            <p class="role">{{ user.role }}</p>
            <p class="department">{{ user.department }}</p>
          </div>
        </div>

        <!-- Profile Form -->
        <form [formGroup]="profileForm" class="profile-form">
          <div class="form-row">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Nome Completo</mat-label>
              <input matInput formControlName="name" placeholder="Seu nome completo">
              <mat-icon matSuffix>person</mat-icon>
              <mat-error *ngIf="profileForm.get('name')?.hasError('required')">
                Nome é obrigatório
              </mat-error>
              <mat-error *ngIf="profileForm.get('name')?.hasError('minlength')">
                Nome deve ter pelo menos 3 caracteres
              </mat-error>
            </mat-form-field>
          </div>

          <div class="form-row">
            <mat-form-field appearance="outline" class="half-width">
              <mat-label>E-mail</mat-label>
              <input matInput formControlName="email" placeholder="seu@email.com" type="email">
              <mat-icon matSuffix>email</mat-icon>
              <mat-error *ngIf="profileForm.get('email')?.hasError('required')">
                E-mail é obrigatório
              </mat-error>
              <mat-error *ngIf="profileForm.get('email')?.hasError('email')">
                E-mail inválido
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="half-width">
              <mat-label>Telefone</mat-label>
              <input matInput formControlName="phone" placeholder="(11) 99999-9999" type="tel">
              <mat-icon matSuffix>phone</mat-icon>
              <mat-error *ngIf="profileForm.get('phone')?.hasError('required')">
                Telefone é obrigatório
              </mat-error>
            </mat-form-field>
          </div>

          <div class="form-row">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Departamento</mat-label>
              <mat-select formControlName="department">
                <mat-option *ngFor="let dept of departments" [value]="dept.label">
                  {{dept.label}}
                </mat-option>
              </mat-select>
              <mat-icon matSuffix>business</mat-icon>
            </mat-form-field>
          </div>
        </form>

        <!-- Action Buttons -->
        <div class="profile-actions" *ngIf="isEditMode">
          <button mat-button class="secondary-btn" (click)="toggleEditMode()" [disabled]="isLoading">
            <mat-icon>close</mat-icon>
            Cancelar
          </button>

          <button mat-raised-button
                  color="primary"
                  class="primary-btn"
                  (click)="onSaveProfile()"
                  [disabled]="isLoading || profileForm.invalid">
            <mat-icon>save</mat-icon>
            Salvar Alterações
          </button>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Card de Alteração de Senha -->
    <mat-card class="profile-card password-card">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>lock</mat-icon>
          Segurança
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <form [formGroup]="passwordForm" class="password-form">
          <div class="form-row">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Senha Atual</mat-label>
              <input matInput
                     [type]="hideCurrentPassword ? 'password' : 'text'"
                     formControlName="currentPassword"
                     placeholder="Digite sua senha atual">
              <button mat-icon-button
                      matSuffix
                      (click)="hideCurrentPassword = !hideCurrentPassword"
                      type="button">
                <mat-icon>{{hideCurrentPassword ? 'visibility' : 'visibility_off'}}</mat-icon>
              </button>
              <mat-error *ngIf="passwordForm.get('currentPassword')?.hasError('required')">
                Senha atual é obrigatória
              </mat-error>
            </mat-form-field>
          </div>

          <div class="form-row">
            <mat-form-field appearance="outline" class="half-width">
              <mat-label>Nova Senha</mat-label>
              <input matInput
                     [type]="hideNewPassword ? 'password' : 'text'"
                     formControlName="newPassword"
                     placeholder="Digite a nova senha">
              <button mat-icon-button
                      matSuffix
                      (click)="hideNewPassword = !hideNewPassword"
                      type="button">
                <mat-icon>{{hideNewPassword ? 'visibility' : 'visibility_off'}}</mat-icon>
              </button>
              <mat-error *ngIf="passwordForm.get('newPassword')?.hasError('required')">
                Nova senha é obrigatória
              </mat-error>
              <mat-error *ngIf="passwordForm.get('newPassword')?.hasError('minlength')">
                Senha deve ter pelo menos 6 caracteres
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="half-width">
              <mat-label>Confirmar Senha</mat-label>
              <input matInput
                     [type]="hideConfirmPassword ? 'password' : 'text'"
                     formControlName="confirmPassword"
                     placeholder="Confirme a nova senha">
              <button mat-icon-button
                      matSuffix
                      (click)="hideConfirmPassword = !hideConfirmPassword"
                      type="button">
                <mat-icon>{{hideConfirmPassword ? 'visibility' : 'visibility_off'}}</mat-icon>
              </button>
              <mat-error *ngIf="passwordForm.get('confirmPassword')?.hasError('required')">
                Confirmação é obrigatória
              </mat-error>
              <mat-error *ngIf="passwordForm.get('confirmPassword')?.hasError('mismatch')">
                Senhas não coincidem
              </mat-error>
            </mat-form-field>
          </div>

          <div class="password-actions">
            <button mat-raised-button
                    color="warn"
                    class="change-password-btn"
                    (click)="onChangePassword()"
                    [disabled]="isLoading || passwordForm.invalid">
              <mat-icon>security</mat-icon>
              Alterar Senha
            </button>
          </div>
        </form>
      </mat-card-content>
    </mat-card>

    <!-- Card de Estatísticas da Conta -->
    <mat-card class="profile-card stats-card">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>analytics</mat-icon>
          Informações da Conta
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="account-stats">
          <div class="stat-item">
            <mat-icon class="stat-icon">schedule</mat-icon>
            <div class="stat-content">
              <h4>Último Acesso</h4>
              <p>{{ formatDate(user.lastLogin) }}</p>
            </div>
          </div>

          <div class="stat-item">
            <mat-icon class="stat-icon">calendar_today</mat-icon>
            <div class="stat-content">
              <h4>Membro desde</h4>
              <p>{{ formatDate(user.createdAt) }}</p>
            </div>
          </div>

          <div class="stat-item">
            <mat-icon class="stat-icon">admin_panel_settings</mat-icon>
            <div class="stat-content">
              <h4>Nível de Acesso</h4>
              <p>{{ user.role }}</p>
            </div>
          </div>

          <div class="stat-item">
            <mat-icon class="stat-icon">verified_user</mat-icon>
            <div class="stat-content">
              <h4>Status da Conta</h4>
              <p>Ativa</p>
            </div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Loading Overlay -->
  <div class="loading-overlay" *ngIf="isLoading">
    <mat-spinner diameter="50"></mat-spinner>
  </div>
</div>
